<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Board Game - PDF —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.cypress.io/dist/html2canvas.min.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –≤ –≤–∞—à–µ–º –ª—é–±–∏–º–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ */
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin: 30px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            min-height: 500px;
            position: relative;
        }
        .cell {
            width: 100%;
            height: 70px;
            border: 2px solid #95a5a6;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 9px;
            font-weight: bold;
            padding: 5px;
            overflow: hidden;
            position: relative;
            background: white;
        }
        .cell.start { background: #2ecc71; color: white; border-color: #27ae60; }
        .cell.finish { background: #e74c3c; color: white; border-color: #c0392b; }
        .cell.image { background: #3498db; color: white; border-color: #2980b9; }
        .cell.task { background: #f1c40f; color: #333; border-color: #f39c12; }
        .cell-number {
            position: absolute;
            top: 3px;
            left: 3px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn {
            background: linear-gradient(45deg, #2ecc71, #1abc9c);
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: block;
            margin: 30px auto;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .status {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #7f8c8d;
            min-height: 20px;
        }
        .spiral-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            stroke: #e74c3c;
            stroke-width: 3;
            fill: none;
            stroke-dasharray: 5,3;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≤ Board Game - PDF —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏</h1>
        <div class="game-board" id="gameBoard">
            <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
        <button class="btn" id="downloadBtn">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –∏–≥—Ä—É –∫–∞–∫ PDF</button>
        <div class="status" id="status"></div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const imagePaths = [
            'Photos/Screenshot_20260206_162503_YouTube.jpg',
            'Photos/Screenshot_20260206_162250_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162245_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162242_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162238_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162156_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162147_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162137_YandexDisk.jpg',
            'Photos/Screenshot_20260206_162130_YandexDisk.jpg',
            'Photos/Screenshot_20260206_002029_YouTube.jpg',
            'Photos/Screenshot_20260206_002017_YouTube.jpg'
        ];

        const tasks = [
            "Skip next turn (–ü—Ä–æ–ø—É—Å—Ç–∏ —Ö–æ–¥)",
            "Go back 2 spaces (–ü—Ä–æ–π–¥–∏ –Ω–∞ –¥–≤–µ –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥)",
            "Go back 3 spaces (–ü—Ä–æ–π–¥–∏ –Ω–∞ —Ç—Ä–∏ –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥)",
            "Move forward 2 spaces (–ü—Ä–æ–π–¥–∏ –Ω–∞ –¥–≤–µ –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥)",
            "Skip 2 turns (–ü—Ä–æ–ø—É—Å—Ç–∏ –¥–≤–∞ —Ö–æ–¥–∞)",
            "Go back to start (–í–µ—Ä–Ω–∏—Å—å –Ω–∞ —Å—Ç–∞—Ä—Ç)",
            "Miss a turn (–ü—Ä–æ–ø—É—Å—Ç–∏ —Ö–æ–¥)",
            "Go back 1 space (–í–µ—Ä–Ω–∏—Å—å –Ω–∞ –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É –Ω–∞–∑–∞–¥)",
            "Skip your next turn (–ü—Ä–æ–ø—É—Å—Ç–∏ —Å–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥)",
            "Move forward 3 spaces (–ü—Ä–æ–π–¥–∏ –Ω–∞ —Ç—Ä–∏ –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥)",
            "Lose a turn (–ü–æ—Ç–µ—Ä—è–π —Ö–æ–¥)",
            "Go back 4 spaces (–í–µ—Ä–Ω–∏—Å—å –Ω–∞ —á–µ—Ç—ã—Ä–µ –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥)",
            "Skip one turn (–ü—Ä–æ–ø—É—Å—Ç–∏ –æ–¥–∏–Ω —Ö–æ–¥)",
            "Move ahead 1 space (–ü—Ä–æ–π–¥–∏ –Ω–∞ –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É –≤–ø–µ—Ä–µ–¥)",
            "Go back 2 spaces (–í–µ—Ä–Ω–∏—Å—å –Ω–∞ –¥–≤–µ –∫–ª–µ—Ç–∫–∏ –Ω–∞–∑–∞–¥)"
        ];

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ø–∏—Ä–∞–ª–∏ (40 –∫–ª–µ—Ç–æ–∫)
        const spiralCoords = [
            [4,4],[4,3],[3,3],[3,4],[3,5],[4,5],[5,5],[5,4],[5,3],[5,2],
            [4,2],[3,2],[2,2],[2,3],[2,4],[2,5],[2,6],[3,6],[4,6],[5,6],
            [6,6],[6,5],[6,4],[6,3],[6,2],[6,1],[5,1],[4,1],[3,1],[2,1],
            [1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[1,7],[2,7],[3,7],[4,7]
        ];

        // ========== –°–û–ó–î–ê–ù–ò–ï –ò–ì–†–û–í–û–ì–û –ü–û–õ–Ø ==========
        const gameBoard = document.getElementById('gameBoard');
        let imageIndex = 0;
        let taskIndex = 0;

        for (let i = 0; i < 40; i++) {
            const coords = spiralCoords[i];
            const cell = document.createElement('div');
            const cellNumber = i + 1;

            let cellType = 'task';
            let content = '';

            if (i === 0) {
                cellType = 'start';
                content = 'START';
            } else if (i === 39) {
                cellType = 'finish';
                content = 'FINISH';
            } else if (i % 3 === 0) {
                // –ö–ª–µ—Ç–∫–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π
                cellType = 'image';
                const imgPath = imagePaths[imageIndex % imagePaths.length];
                content = `<img src="${imgPath}" alt="Image ${cellNumber}" style="width:100%; height:100%; object-fit:cover;" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div style=\'background:linear-gradient(135deg,#3498db,#2c3e50); color:white; width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:10px;\'>IMG ${cellNumber}</div>'">`;
                imageIndex++;
            } else {
                // –ö–ª–µ—Ç–∫–∞ —Å –∑–∞–¥–∞–Ω–∏–µ–º
                cellType = 'task';
                content = tasks[taskIndex % tasks.length];
                taskIndex++;
            }

            cell.className = `cell ${cellType}`;
            cell.style.gridColumn = coords[0] + 1;
            cell.style.gridRow = coords[1] + 1;
            cell.innerHTML = `<div class="cell-number">${cellNumber}</div>${content}`;
            gameBoard.appendChild(cell);
        }

        // ========== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –ö–ê–†–¢–ò–ù–û–ö –í DATA URL ==========
        async function loadImageAsDataURL(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const blob = await response.blob();
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${url}:`, error);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º fallback-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Ü–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç)
                return `data:image/svg+xml;base64,${btoa(
                    `<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
                        <rect width="100" height="100" fill="#3498db"/>
                        <text x="50" y="50" font-family="Arial" font-size="12" fill="white" text-anchor="middle" dy=".3em">IMG</text>
                    </svg>`
                )}`;
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–°–ö–ê–ß–ê–¢–¨ PDF" ==========
        document.getElementById('downloadBtn').addEventListener('click', async function() {
            const btn = this;
            const status = document.getElementById('status');

            btn.disabled = true;
            btn.textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫...';
            status.textContent = '–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏...';

            try {
                // 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –∑–∞–º–µ–Ω—è–µ–º src –Ω–∞ dataURL
                const images = gameBoard.querySelectorAll('img');
                for (const img of images) {
                    const dataURL = await loadImageAsDataURL(img.src);
                    img.src = dataURL;
                }

                status.textContent = '–°–æ–∑–¥–∞—ë–º —Å–Ω–∏–º–æ–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è...';
                btn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ PDF...';

                // 2. –î–µ–ª–∞–µ–º —Å–Ω–∏–º–æ–∫ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è —Å –ø–æ–º–æ—â—å—é html2canvas
                const canvas = await html2canvas(gameBoard, {
                    useCORS: true,       // –†–∞–∑—Ä–µ—à–∏—Ç—å cross-origin (–¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Å —Ç–æ–≥–æ –∂–µ origin)
                    allowTaint: true,    // –†–∞–∑—Ä–µ—à–∏—Ç—å "–∑–∞–≥—Ä—è–∑–Ω—ë–Ω–Ω—ã–π" canvas (–µ—Å–ª–∏ useCORS –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
                    scale: 2,            // –£–¥–≤–æ–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —á—ë—Ç–∫–æ–≥–æ PDF
                    backgroundColor: '#ffffff',
                    logging: false
                });

                status.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...';

                // 3. –°–æ–∑–¥–∞—ë–º PDF –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º canvas –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ–Ω–æ –≤–ø–∏—Å–∞–ª–æ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
                const imgWidth = pageWidth - 20; // –û—Ç—Å—Ç—É–ø—ã –ø–æ 10 –º–º —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ–µ, —É–º–µ–Ω—å—à–∞–µ–º –µ–≥–æ
                let finalHeight = imgHeight;
                let finalWidth = imgWidth;
                if (imgHeight > pageHeight - 20) {
                    finalHeight = pageHeight - 20;
                    finalWidth = (canvas.width * finalHeight) / canvas.height;
                }

                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                const x = (pageWidth - finalWidth) / 2;
                const y = (pageHeight - finalHeight) / 2;

                const imgData = canvas.toDataURL('image/jpeg', 0.9);
                pdf.addImage(imgData, 'JPEG', x, y, finalWidth, finalHeight);

                // 4. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ–¥–ø–∏—Å—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                pdf.setFontSize(16);
                pdf.setTextColor(44, 62, 80);
                pdf.text('Board Game', pageWidth / 2, 15, { align: 'center' });
                pdf.setFontSize(10);
                pdf.setTextColor(100, 100, 100);
                pdf.text('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é html2canvas + jsPDF', pageWidth / 2, pageHeight - 10, { align: 'center' });

                // 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
                pdf.save('board_game_with_images.pdf');

                status.textContent = '‚úÖ PDF —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!';
                btn.textContent = '‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –µ—â—ë —Ä–∞–∑';

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF:', error);
                status.textContent = '‚ùå –û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.';
                btn.textContent = '‚¨áÔ∏è –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    status.textContent = '';
                }, 3000);
            }
        });
    </script>
</body>
</html>
